"use strict";var at=Object.create;var L=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var ut=Object.getOwnPropertyNames;var ct=Object.getPrototypeOf,dt=Object.prototype.hasOwnProperty;var ft=(f,t)=>()=>(t||f((t={exports:{}}).exports,t),t.exports),ht=(f,t)=>{for(var s in t)L(f,s,{get:t[s],enumerable:!0})},V=(f,t,s,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of ut(t))!dt.call(f,l)&&l!==s&&L(f,l,{get:()=>t[l],enumerable:!(c=ot(t,l))||c.enumerable});return f};var W=(f,t,s)=>(s=f!=null?at(ct(f)):{},V(t||!f||!f.__esModule?L(s,"default",{value:f,enumerable:!0}):s,f)),lt=f=>V(L({},"__esModule",{value:!0}),f);var et=ft((X,B)=>{(function(f,t){typeof X=="object"&&typeof B<"u"?B.exports=t():typeof define=="function"&&define.amd?define(t):(f=typeof globalThis<"u"?globalThis:f||self).dayjs=t()})(X,function(){"use strict";var f=1e3,t=6e4,s=36e5,c="millisecond",l="second",M="minute",k="hour",_="day",K="week",D="month",G="quarter",w="year",I="date",Z="Invalid Date",nt=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,rt=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,it={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(a){var r=["th","st","nd","rd"],e=a%100;return"["+a+(r[(e-20)%10]||r[e]||r[0])+"]"}},R=function(a,r,e){var i=String(a);return!i||i.length>=r?a:""+Array(r+1-i.length).join(e)+a},st={s:R,z:function(a){var r=-a.utcOffset(),e=Math.abs(r),i=Math.floor(e/60),n=e%60;return(r<=0?"+":"-")+R(i,2,"0")+":"+R(n,2,"0")},m:function a(r,e){if(r.date()<e.date())return-a(e,r);var i=12*(e.year()-r.year())+(e.month()-r.month()),n=r.clone().add(i,D),o=e-n<0,u=r.clone().add(i+(o?-1:1),D);return+(-(i+(e-n)/(o?n-u:u-n))||0)},a:function(a){return a<0?Math.ceil(a)||0:Math.floor(a)},p:function(a){return{M:D,y:w,w:K,d:_,D:I,h:k,m:M,s:l,ms:c,Q:G}[a]||String(a||"").toLowerCase().replace(/s$/,"")},u:function(a){return a===void 0}},E="en",C={};C[E]=it;var J=function(a){return a instanceof A},P=function a(r,e,i){var n;if(!r)return E;if(typeof r=="string"){var o=r.toLowerCase();C[o]&&(n=o),e&&(C[o]=e,n=o);var u=r.split("-");if(!n&&u.length>1)return a(u[0])}else{var h=r.name;C[h]=r,n=h}return!i&&n&&(E=n),n||!i&&E},m=function(a,r){if(J(a))return a.clone();var e=typeof r=="object"?r:{};return e.date=a,e.args=arguments,new A(e)},d=st;d.l=P,d.i=J,d.w=function(a,r){return m(a,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var A=function(){function a(e){this.$L=P(e.locale,null,!0),this.parse(e)}var r=a.prototype;return r.parse=function(e){this.$d=function(i){var n=i.date,o=i.utc;if(n===null)return new Date(NaN);if(d.u(n))return new Date;if(n instanceof Date)return new Date(n);if(typeof n=="string"&&!/Z$/i.test(n)){var u=n.match(nt);if(u){var h=u[2]-1||0,p=(u[7]||"0").substring(0,3);return o?new Date(Date.UTC(u[1],h,u[3]||1,u[4]||0,u[5]||0,u[6]||0,p)):new Date(u[1],h,u[3]||1,u[4]||0,u[5]||0,u[6]||0,p)}}return new Date(n)}(e),this.$x=e.x||{},this.init()},r.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},r.$utils=function(){return d},r.isValid=function(){return this.$d.toString()!==Z},r.isSame=function(e,i){var n=m(e);return this.startOf(i)<=n&&n<=this.endOf(i)},r.isAfter=function(e,i){return m(e)<this.startOf(i)},r.isBefore=function(e,i){return this.endOf(i)<m(e)},r.$g=function(e,i,n){return d.u(e)?this[i]:this.set(n,e)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(e,i){var n=this,o=!!d.u(i)||i,u=d.p(e),h=function(j,g){var U=d.w(n.$u?Date.UTC(n.$y,g,j):new Date(n.$y,g,j),n);return o?U:U.endOf(_)},p=function(j,g){return d.w(n.toDate()[j].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(g)),n)},y=this.$W,$=this.$M,S=this.$D,x="set"+(this.$u?"UTC":"");switch(u){case w:return o?h(1,0):h(31,11);case D:return o?h(1,$):h(0,$+1);case K:var T=this.$locale().weekStart||0,F=(y<T?y+7:y)-T;return h(o?S-F:S+(6-F),$);case _:case I:return p(x+"Hours",0);case k:return p(x+"Minutes",1);case M:return p(x+"Seconds",2);case l:return p(x+"Milliseconds",3);default:return this.clone()}},r.endOf=function(e){return this.startOf(e,!1)},r.$set=function(e,i){var n,o=d.p(e),u="set"+(this.$u?"UTC":""),h=(n={},n[_]=u+"Date",n[I]=u+"Date",n[D]=u+"Month",n[w]=u+"FullYear",n[k]=u+"Hours",n[M]=u+"Minutes",n[l]=u+"Seconds",n[c]=u+"Milliseconds",n)[o],p=o===_?this.$D+(i-this.$W):i;if(o===D||o===w){var y=this.clone().set(I,1);y.$d[h](p),y.init(),this.$d=y.set(I,Math.min(this.$D,y.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},r.set=function(e,i){return this.clone().$set(e,i)},r.get=function(e){return this[d.p(e)]()},r.add=function(e,i){var n,o=this;e=Number(e);var u=d.p(i),h=function($){var S=m(o);return d.w(S.date(S.date()+Math.round($*e)),o)};if(u===D)return this.set(D,this.$M+e);if(u===w)return this.set(w,this.$y+e);if(u===_)return h(1);if(u===K)return h(7);var p=(n={},n[M]=t,n[k]=s,n[l]=f,n)[u]||1,y=this.$d.getTime()+e*p;return d.w(y,this)},r.subtract=function(e,i){return this.add(-1*e,i)},r.format=function(e){var i=this,n=this.$locale();if(!this.isValid())return n.invalidDate||Z;var o=e||"YYYY-MM-DDTHH:mm:ssZ",u=d.z(this),h=this.$H,p=this.$m,y=this.$M,$=n.weekdays,S=n.months,x=n.meridiem,T=function(g,U,H,N){return g&&(g[U]||g(i,o))||H[U].slice(0,N)},F=function(g){return d.s(h%12||12,g,"0")},j=x||function(g,U,H){var N=g<12?"AM":"PM";return H?N.toLowerCase():N};return o.replace(rt,function(g,U){return U||function(H){switch(H){case"YY":return String(i.$y).slice(-2);case"YYYY":return d.s(i.$y,4,"0");case"M":return y+1;case"MM":return d.s(y+1,2,"0");case"MMM":return T(n.monthsShort,y,S,3);case"MMMM":return T(S,y);case"D":return i.$D;case"DD":return d.s(i.$D,2,"0");case"d":return String(i.$W);case"dd":return T(n.weekdaysMin,i.$W,$,2);case"ddd":return T(n.weekdaysShort,i.$W,$,3);case"dddd":return $[i.$W];case"H":return String(h);case"HH":return d.s(h,2,"0");case"h":return F(1);case"hh":return F(2);case"a":return j(h,p,!0);case"A":return j(h,p,!1);case"m":return String(p);case"mm":return d.s(p,2,"0");case"s":return String(i.$s);case"ss":return d.s(i.$s,2,"0");case"SSS":return d.s(i.$ms,3,"0");case"Z":return u}return null}(g)||u.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(e,i,n){var o,u=this,h=d.p(i),p=m(e),y=(p.utcOffset()-this.utcOffset())*t,$=this-p,S=function(){return d.m(u,p)};switch(h){case w:o=S()/12;break;case D:o=S();break;case G:o=S()/3;break;case K:o=($-y)/6048e5;break;case _:o=($-y)/864e5;break;case k:o=$/s;break;case M:o=$/t;break;case l:o=$/f;break;default:o=$}return n?o:d.a(o)},r.daysInMonth=function(){return this.endOf(D).$D},r.$locale=function(){return C[this.$L]},r.locale=function(e,i){if(!e)return this.$L;var n=this.clone(),o=P(e,i,!0);return o&&(n.$L=o),n},r.clone=function(){return d.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},a}(),Q=A.prototype;return m.prototype=Q,[["$ms",c],["$s",l],["$m",M],["$H",k],["$W",_],["$M",D],["$y",w],["$D",I]].forEach(function(a){Q[a[1]]=function(r){return this.$g(r,a[0],a[1])}}),m.extend=function(a,r){return a.$i||(a(r,A,m),a.$i=!0),m},m.locale=P,m.isDayjs=J,m.unix=function(a){return m(1e3*a)},m.en=C[E],m.Ls=C,m.p={},m})});var gt={};ht(gt,{Template:()=>z});module.exports=lt(gt);var tt=[{key:"Xiaomi 13",ids:["17971","17969","18363","17972","18443"]},{key:"k60",ids:["18077","18075","18073"]},{key:"civi3",ids:["18482","18569"]},{key:"note12",ids:["16642","18542","18268","16644","18092","16646"]}];var q=[{key:"k60",ids:["18075"]},{key:"k60p",ids:["18077"]},{key:"\u5C0F\u7C7313",ids:["17971"]},{key:"\u5C0F\u7C7313p",ids:["17969"]},{key:"\u5C0F\u7C7313\u4EC5\u9650\u5B9A\u8272",ids:["17972"]},{key:"13U",ids:["18363","18443"]},{key:"civi3",ids:["18482","18569"]},{key:"Note12T",ids:["18268"]},{key:"12T Pro",ids:["18542"]}];var O=[{key:"\u5C0F\u7C7313\u548C\u5C0F\u7C7313Pro",date:"2022-12-14",ids:["17971","17969","17972"]},{key:"\u5C0F\u7C7313Ultra",date:"2023-04-21",ids:["18363","18443"]},{key:"\u5C0F\u7C7313\u7CFB\u5217\u603B\u9500\u91CF",date:"2022-12-14",ids:["17971","17969","17972","18363","18443"]},{key:"\u7EA2\u7C73K60\u7CFB\u5217(\u4E0D\u5305\u62ECK60E)",date:"2022-12-31",ids:["18075","18077"]},{key:"\u7EA2\u7C73Note12T",date:"2023-03-31",ids:["18268"]}];var v=W(require("path")),b=W(require("fs")),Y=W(et()),z=class{constructor(){this.sku=[];this.map={};this.old={};this.getOldSKU().forEach(s=>this.old[s.id]=s)}process(){return this.getAllSKU().then(t=>(this.sku.push(...t),t.forEach(s=>this.map[s.id]=s),t)).then(t=>{let s=v.join(__dirname,"..","result"),c=(0,Y.default)().format("YYYY-MM-DD"),l=(0,Y.default)().format("YYYY-MM-DD HH:mm:ss");b.existsSync(v.join(s,c+".json"))?b.writeFileSync(v.join(s,l+".json"),JSON.stringify(t,null,4),"utf-8"):b.writeFileSync(v.join(s,c+".json"),JSON.stringify(t,null,4),"utf-8")}).then(()=>this.render())}getSearchResult(t){let s=new URLSearchParams("client_id=180100031051&channel_id=&webp=1&query=Xiaomi+13&version=2&page_index=1&page_size=20&activity_id=&activity_type=");return s.set("query",t.replace(/ /g,"+")),fetch("https://m.mi.com/v1/hisearch/query_v3",{headers:{accept:"application/json, text/plain, */*","accept-language":"zh-CN,zh;q=0.9","content-type":"application/x-www-form-urlencoded","sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","sentry-trace":"4d541bd796884b15b6c2b44256c84a85-be7fa8415af2f7ba-1","x-requested-with":"XMLHttpRequest","x-user-agent":"channel/mishop platform/mishop.m",xmuuid:"XMGUEST-90EC06F0-06C7-11EE-A486-912F957E2039",cookie:'mstuid=1672138670582_7472; xmuuid=XMGUEST-90EC06F0-06C7-11EE-A486-912F957E2039; xmUuid=XMGUEST-90EC06F0-06C7-11EE-A486-912F957E2039; _utm_data={"mtm":"","device_id":""}; deviceId=xmdevice_j7swgpc3w8dxnuan; Hm_lvt_c3e3e8b3ea48955284516b186acf0f4e=1686316447,1688698936; XM_agreement=0; Hm_lpvt_c3e3e8b3ea48955284516b186acf0f4e=1688698942; Hm_lvt_183aed755f0fd3efc9912dbf6550ec49=1686316499,1688698948; mishopDeviceId=BU8SOd0QlJazyCTB3KS1gGBt+fdau4SBUyIpGkUY82d0RuJCrOe/DvbkDez2UxCsEjgzU8lgxXUOmlPAjMq48cQ; lastsource=s1.mi.com; xm_vistor=1672138670582_7472_1688698941862-1688698953127; mstz=||2100808401.40||https%253A%252F%252Fs1.mi.com%252F|https%25253A%25252F%25252Fs1.mi.com%25252F; Hm_lpvt_183aed755f0fd3efc9912dbf6550ec49=1688698954; pageid=13c7dea5c88bfe74',Referer:"https://m.mi.com/search","Referrer-Policy":"strict-origin-when-cross-origin"},body:s.toString(),method:"POST"}).then(c=>c.json()).then(c=>c.data.list_v2.map(l=>({id:l.body.product_id,name:l.body.name,price:l.body.price,count:l.body.comments_total})))}getAllSKU(){return Promise.all(tt.map(t=>this.getSearchResult(t.key).then(s=>s.filter(c=>t.ids.includes(String(c.id)))))).then(t=>t.flat(1))}getOldSKU(){let t=v.join(__dirname,"..","result"),s=(0,Y.default)().add(-1,"d").format("YYYY-MM-DD");return b.existsSync(v.join(t,s+".json"))?JSON.parse(b.readFileSync(v.join(t,s+".json"),"utf-8")):this.sku.map(c=>({...c,count:0}))}getAllSPU(t){let s={};return t.map(c=>s[c.id]=c),q.map(c=>({name:c.key,count:c.ids.map(l=>s[l].count).reduce((l,M)=>l+M)}))}getCount(t){return t.ids.map(s=>this.map[s].count).reduce((s,c)=>s+c)}getOldCount(t){return t.ids.map(s=>this.old[s].count).reduce((s,c)=>s+c)}getSPUTemplateInfo(t,s){return`<p>\uFF08${t}\uFF09${s.key} ${this.getCount(s)}</p>`}getSeriesTemplateInfo(t){let s=(0,Y.default)(t.date,"YYYY-MM-DD"),c=(0,Y.default)().add(-16,"d"),l=c.diff(s,"d")+1,M=this.getCount(t),k=this.getOldCount(t),_=M-k;return`<p>\u4ECA\u5929\u662F${t.key}\u786E\u8BA4\u6536\u8D27\u7684\u7B2C ${l} \u5929\uFF08\u8D2D\u4E70\u65E5\u671F\u5927\u6982${c.format("YYYY/MM/DD")} \u9644\u8FD1\uFF0C\u7ECF\u8FC7\u6821\u5BF9\u6570\u636E\u670916\u5929\u5EF6\u65F6\uFF09\uFF0C\u5728\u5C0F\u7C73\u5546\u57CE\u8BC4\u8BBA\u603B\u6570\uFF1A<b>${M}</b>\uFF0C\u65E5\u65B0\u589E <b>${_}</b></p>`}render(){let t=[`<h1>\u5C0F\u7C73 2023\u5E74\u4E3B\u6D41\u673A\u578B\u9500\u91CF\u8DDF\u8E2A${(0,Y.default)().format("YYYY/MM/DD")}</h1>`];return t.push("<h2>\u4E00\u300113 \u7CFB\u5217</h2>"),t.push("<p> </p>"),t.push(this.getSeriesTemplateInfo(O[0])),t.push("<p> </p>"),t.push(this.getSeriesTemplateInfo(O[1])),t.push("<p></p>"),t.push(`<p>\u5C0F\u7C7313\u7CFB\u5217\u603B\u9500\u91CF\u4E3A <b>${this.getCount(O[2])}</b>\uFF0C\u65E5\u65B0\u589E <b>${this.getCount(O[2])-this.getOldCount(O[2])}</b></p>`),t.push("<p>--\u4F5C\u4E3A\u53C2\u8003\uFF0C\u5C0F\u7C7312s\u548C\u5C0F\u7C7312sp\u76EE\u524D\u603B\u91CF46\u4E07\uFF0C\u5C0F\u7C7312\u548C\u5C0F\u7C7312p\u603B\u91CF73\u4E07\uFF0C\u5C0F\u7C7312su\u603B\u91CF17\u4E07\u3002</p>"),t.push("<h2>\u4E8C\u3001\u7EA2\u7C73 K60 \u7CFB\u5217(\u4E0D\u5305\u62ECK60E)</h2>"),t.push(this.getSeriesTemplateInfo(O[3])),t.push("<h2>\u4E09\u3001\u7EA2\u7C73Note12T</h2>"),t.push(this.getSeriesTemplateInfo(O[4])),t.push("<h2>\u56DB\u3001\u5355\u54C1\u6570\u636E</h2>"),q.forEach((s,c)=>t.push(this.getSPUTemplateInfo(c+1,s))),t.push("<p>\u{1F525}\u6700\u540E\uFF1A\u6570\u636E\u6574\u7406\u4E0D\u6613\uFF0C\u5982\u679C\u60A8\u89C9\u5F97\u6709\u4EF7\u503C\uFF0C\u5E2E\u5FD9\u70B9\u4E2A\u5173\u6CE8\u5457\u2B50\uFE0F\u2B50\uFE0F\u2B50\uFE0F</p>"),`<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>\u76D1\u63A7</title></head><body>${t.join(`
`)}</body></html>`}},$t=new z;$t.process().then(f=>{let t=v.join(__dirname,"..","template"),s=(0,Y.default)().format("YYYY-MM-DD"),c=(0,Y.default)().format("YYYY-MM-DD HH:mm:ss");b.existsSync(v.join(t,s+".html"))?b.writeFileSync(v.join(t,c+".html"),f,"utf-8"):b.writeFileSync(v.join(t,s+".html"),f,"utf-8")});0&&(module.exports={Template});
